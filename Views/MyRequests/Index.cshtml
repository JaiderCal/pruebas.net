@{
    List<Dictionary<string, object>> sortList = ViewBag.RequestsList;

    string idClicked = ViewBag.ClickeID;
    var reqType = ViewBag.ReqType;
    var criteria = ViewBag.Criteria;
    string clicked_filter = ViewBag.ClickedFilter;

    int tabindexCounter = 110;
}

<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
    var filterStatus = "All";
    jQuery(document).ready(function ($) {
        $('#sortByOptions').val('@criteria');

        $('#sortByOptions').change(function () {
            var clicked_filter = $('.filter .clicked').attr("id");
            var criteria = $(this).find(":selected").val();
            $(location).attr('href', '/MyRequests?criteria=' + criteria + '&clickedFilter=' + clicked_filter + '&force=false');
        });

        $('.list_data_item').on('click', function (event) {
            loadRequestDetails($(this), event);
        });
        $('.list_data_item').keydown(function (event) {
            var keycode = event.keyCode || event.which;
            if (keycode == '13') {
                loadRequestDetails($(this), event);
            }
        });

        var loadRequestDetails = function (that, event) {
            var idClick = that.find('.id').text();
            var reqtype = that.attr('data-type');
            $('.list_data_item').removeClass('clicked');
            that.addClass('clicked');

            pageLoaderAction('show');
            $.ajax({
                url: '/MyRequests/RequestDetails',
                type: 'POST',
                data: { id: idClick, Type: reqtype },
                success: function (result) {
                    // load this page with new contents
                    if ($(window).width() < 1024) {
                        $("div.list_item_page").show();
                        $('div.vertical_list').hide();
                        $('.nav_back').show();
                    }
                    $("div.list_item_page").html(result);
                    //var viewPortHeight = $(window).height();
                    // $('.action_log_list').height(viewPortHeight / 5);
                    pageLoaderAction('hide');
                }
            });
        }

        //adjustListDataItemsHeight();
        filterActions();
        //sortActions();
        filterUIActions();
        sideMenuAction();
        mobileActions();
        filterReqeustSearchShow();
        //submitFormAction();

        $('#active').trigger('click');

        //vertical_list list_header list_filter_sort filter
        $('#@clicked_filter').trigger('click');


        window.addEventListener("resize", onresize);
        $(window).trigger('resize');


    });


    var onresize = function (event) {
        // need to use window.innerHeight/window.innerWidth as fix for IE10 because body.height/body.width gives bad results
        var bodyHeight = window.innerHeight;
        var bodyWidth = window.innerWidth;

        $('.list_item_page').width(bodyWidth - $('.list_data_items').outerWidth(true) - $('.side_nav_bar').outerWidth(true) - parseInt($('.list_item_page').css('padding-left')) - parseInt($('.list_item_page').css('padding-right')))
        $('.list_item_page').height(bodyHeight - $('.top_bar').outerHeight(true) - parseInt($('.list_item_page').css('padding-top')) - parseInt($('.list_item_page').css('padding-bottom')));
        $('.list_data_items').height(bodyHeight - $('.top_bar').outerHeight(true) - ($('.list_footer').outerHeight(true) || 0) - $('.list_header').outerHeight(true));
    }

    function loadDiv(status) {
        filterStatus = status;
        $.each($('.list_data_item'), function (i, div) {
            $(this).show(); 
            var reqStatus = $(this).find('.list_data_item_tags .status').first().text();
            if ((status != "@Html.Raw(Resources.SelfServicePortalResources.All)") && (reqStatus != status)) {
                $(this).hide();
            }
        });
        if ($(window).width() > 786) {
            $('.list_data_item:visible').first().trigger('click');
        }
    }

    //var triggerActiveClick = function () {
    //    //$('.filter span.active').trigger('click');
    //    if ($(window).width() > 786) {
    //        $('.list_data_item:visible').first().trigger('click');
    //    }
    //}

    mobileActions = function () {
        if ($(window).width() < 1024) {
            $('.list_item_page').hide();
            $('.vertical_list').css('width', '100%');
            $('.list_item_page').css({ 'width': '85%' });
            backNavigation();
        } else {
            //$('.list_item_page').css({ 'width': '' });
        }
    }

    var backNavigation = function () {
        $('body').on('click', '.nav_back', function (event) {
            $("div.list_item_page").hide();
            $('div.vertical_list').show();
            $('.nav_back').hide();
        });
    }

    sideMenuAction = function () {
        $('.side_menu').find('.side_nav_request').css('background-color', '#255F85');
    }

    adjustListDataItemsHeight = function () {
        var viewPortHeight = $(window).height();
        var topBarHeight = $('.top_bar').height();
        var listHeaderHeight = $('.list_header').height();
        $('.vertical_list .list_data_items').height(viewPortHeight - (topBarHeight + listHeaderHeight + 10));
    }

    filterActions = function () {
        $('.vertical_list').on('click', '.filter span', function (event) {
            var clicked_filter = $(this).text().trim();
            OnSearchOrFilter(clicked_filter);
        });
        $('.vertical_list .filter span').keydown(function (event) {
            var keycode = event.keyCode || event.which;
            if (keycode == '13') {
                var clicked_filter = $(this).text().trim();
                OnSearchOrFilter(clicked_filter);
            }
        });
    }

    filterUIActions = function () {
        $('.vertical_list').on('click', '.filter span', function (event) {
            //Clear all the styles
            $('.vertical_list .filter span').each(function () {
                $(this).removeClass('clicked');
            });
            $(this).addClass('clicked');
        });
        $('.vertical_list .filter span').keydown(function (event) {
            var keycode = event.keyCode || event.which;
            if (keycode == '13') {
                //Clear all the styles
                $('.vertical_list .filter span').each(function () {
                    $(this).removeClass('clicked');
                });
                $(this).addClass('clicked');
            }
        });
    }

    filterReqeustSearchShow = function () {
        $('.my_req_container .vertical_list .filter_search').on('click', function (event) {
            $('#searchRequest').toggle();
        });
    }

    //sortActions = function () {
    //    $('.sort_by select').on("change", function () {
    //        var criteria = $(this).find(':selected').text();
    //        $.ajax({
    //            url: '/MyRequests',
    //            type: 'POST',
    //            data: { criteria: criteria },
    //            success: function (result) {
    //                $('body').html(result);
    //                $('.sort_by select').val(criteria);
    //            }
    //        });
    //    });
    //}    

    function OnSearchOrFilter(clicked_filter) {
        //searchText = input.value;
        searchText = $('#searchRequest').val();
        if (clicked_filter == null) {
            clicked_filter = $('.filter .clicked').text().trim();
        }
        $.each($('.list_data_item'), function (i, div) {
            $(this).show();
            var title = $(this).find('.list_data_item_desc').first().text();
            var id = $(this).find('.list_data_item_tags .id').first().text();
            var reqStatus = $(this).find('.list_data_item_tags .status').first().text().trim();
            var description = $(this).find('.list_data_item_tags .description').first().text();
            if ((clicked_filter != "@Html.Raw(Resources.SelfServicePortalResources.All)") && (reqStatus != clicked_filter)) {
                $(this).hide();
            }
            if ((title.search(new RegExp(searchText, "i")) == -1) && (id.search(new RegExp(searchText, "i")) == -1) && (description.search(new RegExp(searchText, "i")) == -1)) {
                $(this).hide();
            }
        });
        if ($(window).width() > 1023) {
            $('.list_data_item:visible').first().trigger('click');
        }
    }

</script>
</head>
<body class="main_body gutters" scroll="no" style="overflow: hidden;">
    <div class="my_req_container col side_bar_margin top_bar_margin span_24" style="display:block;">
        <div class="my_req_list clr vertical_list" aria-label="@Resources.SelfServicePortalResources.MyRequests" tabindex="100">
            <div class="list_header">
                <div class="list_main_heading list_heading clr">
                    <div class="col span_10">@Resources.SelfServicePortalResources.MyRequests</div>
                    <span class="icon-Filter filter_search" style="position:absolute; right:1.25em; color:#fff; font-size:0.75em; top:1.25em; cursor:pointer;" tabindex="101"></span>
                    <div class="col">
                        <input type="search" placeholder="@Resources.SelfServicePortalResources.FindByKeywords" name="searchRequest" id="searchRequest" style="display:none;" oninput="OnSearchOrFilter()" tabindex="102">
                    </div>
                </div>
                <div class="list_filter_sort">
                    <div class="sort_by row">
                        <div class="col span_8">@Resources.SelfServicePortalResources.SortBy</div>
                        <div class="col span_7">
                            <select aria-label="@Resources.SelfServicePortalResources.SortBy" id="sortByOptions" tabindex="103">
                                <option value="ID" aria-label="@Resources.SelfServicePortalResources.ID">@Resources.SelfServicePortalResources.ID</option>
                                <option value="Title" aria-label="@Resources.SelfServicePortalResources.Title">@Resources.SelfServicePortalResources.Title</option>
                                <option value="LastModifiedDate" aria-label="@Resources.SelfServicePortalResources.LastUpdated" selected="selected">@Resources.SelfServicePortalResources.LastUpdated</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter">
                        <span class="active" id="Active" tabindex="104"> @Resources.SelfServicePortalResources.Active </span>
                        <span id="Resolved" tabindex="105"> @Resources.SelfServicePortalResources.Resolved </span>
                        <span id="Closed" tabindex="106"> @Resources.SelfServicePortalResources.Closed</span>
                        <span class="clicked" id="All" tabindex="107">@Resources.SelfServicePortalResources.All</span>
                    </div>
                </div>
            </div>

            <div class="list_data_items">
                @{
                    if (sortList.Count == 0)
                    {
                        <div class="list_data_item_desc">
                            @Resources.SelfServicePortalResources.NoRequestsFound
                        </div>
                    }
                    foreach (Dictionary<string, object> listEntry in sortList)
                    {
                        <div class="list_data_item" data-type=@listEntry["Type"] tabindex="@tabindexCounter.ToString()">
                            <div class="list_data_item_desc">
                                @listEntry["Title"]
                            </div>
                            <div class="list_data_item_tags">
                                <div class="id">@listEntry["Id"]</div>
                                <div class="status">@listEntry["RequestStatus"]</div>
                                <div class="description" style="display: none;">@listEntry["Description"]</div>
                            </div>
                        </div>
                        tabindexCounter++;
                    }
}
            </div>
        </div>
        <div class="my_req_item list_item_page col"></div>
    </div>
</body>
</html>
